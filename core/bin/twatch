#!/bin/bash

# twatch â€” open twitch chat and stream in i3 + mpv using streamlink
# Usage: twatch <twitch_channel_name> (lowercase)
#
# Example:
#   twatch mrtypo7

WORKSPACE="3"
BROWSER="firefox"
PLAYER="mpv"

if [ -z "$1" ]; then
    echo "Usage: $0 <twitch_channel_name>"
    exit 1
fi

TWITCH_CHANNEL="$1"
TWITCH_URL="https://www.twitch.tv/$TWITCH_CHANNEL"

echo "ðŸ” Checking if $TWITCH_CHANNEL is live..."

# Check if stream is live (quietly)
streamlink --json "$TWITCH_URL" best >/dev/null 2>&1
STATUS=$?

if [ $STATUS -ne 0 ]; then
    echo "âŒ $TWITCH_CHANNEL is offline or does not exist."
    exit 1
fi

echo "âœ… $TWITCH_CHANNEL is live! Launching chat and stream..."

# Open Twitch chat (silent)
i3-msg "workspace $WORKSPACE; exec --no-startup-id $BROWSER --new-window --kiosk https://www.twitch.tv/popout/$TWITCH_CHANNEL/chat" >/dev/null 2>&1

# Start stream silently in background
nohup streamlink --player=$PLAYER "$TWITCH_URL" "1080p,best" >/dev/null 2>&1 &
